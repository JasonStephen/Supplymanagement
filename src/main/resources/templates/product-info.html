<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>产品详情</title>
    <link rel="stylesheet" href="/css/product-show.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- Markdown 渲染库 -->
</head>
<body>
<div class="container">
    <div class="content">
        <!-- 第一行：LOGO 和基本信息 -->
        <div class="product-header">
            <div class="product-logo">
                <img th:src="${details.photo != null ? details.photo : '/products/uploads/products/productdefault.png'}" alt="产品LOGO" width="256" height="256">
            </div>
            <div class="product-info">
                <div class="product-name" th:text="${details.name}"></div>
                <div class="product-category">
                    <span th:text="${details.category}"></span>
                    <button class="btn-action" th:if="${hasGoodsCategoryPermission}" onclick="openCategoryModal()">管理类别</button>
                </div>
                <div class="product-price" th:text="'￥' + ${details.price}"></div>
                <div class="inventory-info">
                    <div th:if="${hasInventoryShowPermission}">
                        库存: <span th:text="${details.quantity}"></span> (状态: <span th:text="${details.inventoryStatus}"></span>)
                    </div>
                    <button class="btn-action" th:if="${hasSetInventoryAlertPermission}" onclick="setAlertThreshold()">设置库存告警</button>
                    <button class="btn-action" th:if="${hasChangeInventoryPermission}" onclick="adjustInventory()">调整库存</button>
                </div>
                <button class="btn-action" th:if="${hasGoodsSetPermission}" onclick="editProduct()">编辑产品</button>
            </div>
        </div>

        <!-- 第二行：产品描述和配方信息 -->
        <div class="product-details">
            <div class="product-description">
                <div id="description-markdown" th:utext="${details.description}"></div>
            </div>
            <div class="product-components" th:if="${hasSetComponentPermission}">
                <h3>配方信息</h3>
                <div id="components-list">
                    <!-- 动态生成配方信息 -->
                </div>
                <button class="btn-action" onclick="openAddComponentModal()">添加配方</button>
            </div>
        </div>
    </div>
</div>

<!-- 类别管理模态框 -->
<div id="categoryModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeCategoryModal()">&times;</span>
        <h2>类别管理</h2>
        <div id="categoryManagement">
            <!-- 类别列表 -->
            <table id="categoryTable">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>名称</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <!-- 动态生成 -->
                </tbody>
            </table>
            <!-- 添加类别表单 -->
            <form id="addCategoryForm">
                <input type="text" id="newCategoryName" placeholder="新类别名称" required />
                <button type="submit">添加</button>
            </form>
        </div>
    </div>
</div>

<!-- 添加/编辑配方模态框 -->
<div id="componentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeComponentModal()">&times;</span>
        <h2 id="componentModalTitle">添加配方</h2>
        <form id="componentForm">
            <input type="hidden" id="componentId">
            <div class="form-group">
                <label for="componentSelect">组件名称</label>
                <select id="componentSelect" class="form-control" required></select>
            </div>
            <div class="form-group">
                <label for="componentQuantity">数量</label>
                <input type="number" id="componentQuantity" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="componentUnit">单位</label>
                <input type="text" id="componentUnit" class="form-control" required>
            </div>
            <button type="submit" class="btn-action">保存</button>
        </form>
    </div>
</div>


<script src="/js/product-info.js"></script>
</body>
</html>
