<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>权限管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
<h1>权限管理</h1>
<div class="mb-3">
    <a th:href="@{/}" class="btn btn-secondary">返回首页</a>
    <a th:href="@{/role}" class="btn btn-info">角色管理</a>
</div>
<div>
    <form id="permissionForm">
        <input type="hidden" id="permissionId" name="permissionId">
        <div class="mb-3">
            <label for="permissionName" class="form-label">权限名称:</label>
            <input type="text" id="permissionName" name="permissionName" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">保存</button>
    </form>
</div>
<div class="mt-4">
    <h2>权限列表</h2>
    <ul id="permissionList" class="list-group"></ul>
</div>
<div class="mt-4">
    <h2>查找权限</h2>
    <input type="text" id="searchPermissionName" class="form-control" placeholder="输入权限名称">
    <button id="findPermissionButton" class="btn btn-primary mt-2">查找</button>
    <ul id="searchResult" class="list-group mt-2"></ul>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadPermissions();

        document.getElementById('permissionForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const permissionId = formData.get('permissionId');
            const url = permissionId ? `/permission/updatePermission?permissionId=${permissionId}` : '/permission/createPermission';
            fetch(url, {
                method: 'POST',
                body: new URLSearchParams(formData)
            }).then(response => {
                if (response.ok) {
                    loadPermissions();
                    this.reset();
                }
            });
        });

        document.getElementById('findPermissionButton').addEventListener('click', function() {
            const permissionName = document.getElementById('searchPermissionName').value;
            fetch(`/permission/findPermission?permissionName=${permissionName}`)
                .then(response => response.json())
                .then(data => {
                    const searchResult = document.getElementById('searchResult');
                    searchResult.innerHTML = '';
                    if (data) {
                        const li = document.createElement('li');
                        li.className = 'list-group-item';
                        li.textContent = data.permissionName;
                        searchResult.appendChild(li);
                    } else {
                        searchResult.textContent = '未找到权限';
                    }
                });
        });
    });

    function loadPermissions() {
        fetch('/permission/getAllPermissions')
            .then(response => response.json())
            .then(data => {
                const permissionList = document.getElementById('permissionList');
                permissionList.innerHTML = '';
                data.forEach(permission => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';
                    li.textContent = permission.permissionName;
                    const editButton = document.createElement('button');
                    editButton.className = 'btn btn-sm btn-warning';
                    editButton.textContent = '编辑';
                    editButton.onclick = () => editPermission(permission);
                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'btn btn-sm btn-danger';
                    deleteButton.textContent = '删除';
                    deleteButton.onclick = () => deletePermission(permission.permissionId);
                    li.appendChild(editButton);
                    li.appendChild(deleteButton);
                    permissionList.appendChild(li);
                });
            });
    }

    function editPermission(permission) {
        document.getElementById('permissionId').value = permission.permissionId;
        document.getElementById('permissionName').value = permission.permissionName;
    }

    function deletePermission(permissionId) {
        fetch(`/permission/deletePermission?permissionId=${permissionId}`, { method: 'DELETE' })
            .then(response => {
                if (response.ok) {
                    loadPermissions();
                }
            });
    }
</script>
</body>
</html>