<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>角色管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
<h1>角色管理</h1>
<div class="mb-3">
    <a th:href="@{/}" class="btn btn-secondary">返回首页</a>
    <a th:href="@{/permission}" class="btn btn-info">权限管理</a>
</div>
<div>
    <form id="roleForm">
        <input type="hidden" id="roleId" name="roleId">
        <div class="mb-3">
            <label for="roleName" class="form-label">角色名称:</label>
            <input type="text" id="roleName" name="roleName" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">保存</button>
    </form>
</div>
<div class="mt-4">
    <h2>角色列表</h2>
    <ul id="roleList" class="list-group"></ul>
</div>
<div class="mt-4">
    <h2>查找角色</h2>
    <input type="text" id="searchRoleName" class="form-control" placeholder="输入角色名称">
    <button id="findRoleButton" class="btn btn-primary mt-2">查找</button>
    <ul id="searchResult" class="list-group mt-2"></ul>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadRoles();

        document.getElementById('roleForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const roleId = formData.get('roleId');
            const url = roleId ? `/role/updateRole?roleId=${roleId}` : '/api/v1/role/createRole';
            fetch(url, {
                method: 'POST',
                body: new URLSearchParams(formData)
            }).then(response => {
                if (response.ok) {
                    loadRoles();
                    this.reset();
                }
            });
        });

        document.getElementById('findRoleButton').addEventListener('click', function() {
            const roleName = document.getElementById('searchRoleName').value;
            fetch(`/role/findRole?roleName=${roleName}`)
                .then(response => response.json())
                .then(data => {
                    const searchResult = document.getElementById('searchResult');
                    searchResult.innerHTML = '';
                    if (data) {
                        const li = document.createElement('li');
                        li.className = 'list-group-item';
                        li.textContent = data.roleName;
                        searchResult.appendChild(li);
                    } else {
                        searchResult.textContent = '未找到角色';
                    }
                });
        });
    });

    function loadRoles() {
        fetch('/role/listRoles?page=0&size=10')
            .then(response => response.json())
            .then(data => {
                const roleList = document.getElementById('roleList');
                roleList.innerHTML = '';
                data.forEach(role => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';
                    li.textContent = role.roleName;
                    const editButton = document.createElement('button');
                    editButton.className = 'btn btn-sm btn-warning';
                    editButton.textContent = '编辑';
                    editButton.onclick = () => editRole(role);
                    const deleteButton = document.createElement('button');
                    deleteButton.className = 'btn btn-sm btn-danger';
                    deleteButton.textContent = '删除';
                    deleteButton.onclick = () => deleteRole(role.roleId);
                    li.appendChild(editButton);
                    li.appendChild(deleteButton);
                    roleList.appendChild(li);
                });
            });
    }

    function editRole(role) {
        document.getElementById('roleId').value = role.roleId;
        document.getElementById('roleName').value = role.roleName;
    }

    function deleteRole(roleId) {
        fetch(`/role/deleteRole?roleId=${roleId}`, { method: 'DELETE' })
            .then(response => {
                if (response.ok) {
                    loadRoles();
                }
            });
    }
</script>
</body>
</html>